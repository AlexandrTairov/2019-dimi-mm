<!DOCTYPE html>

<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="fonts/font-awesome.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="css/bootstrap-select.min.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/user.style.css" type="text/css">
    <link rel="stylesheet" href="css/scroll-list.css" type="text/css">


    <title>Spotter - Universal Directory Listing HTML Template</title>

</head>

<body onunload="" class="page-subpage page-item-detail navigation-off-canvas" id="page-top">

<!-- Outer Wrapper-->
<div id="outer-wrapper">
    <!-- Inner Wrapper -->
    <div id="inner-wrapper">
        <!-- Navigation -->
        <div class="header">
            <div class="wrapper">
                <div class="brand">
                    <a href="/map"><img src="icons/logo.png" alt="logo" height="64px"></a>
                </div>
                <nav class="navigation-items">
                    <div class="wrapper">
                        <ul class="main-navigation navigation-top-header"></ul>
                        <ul class="user-area">
                            <li><a href="sign-in.html">Sign In</a></li>
                            <li><a href="register.html"><strong>Register</strong></a></li>
                        </ul>
                        <a href="submit.html" class="submit-item">
                            <div class="content"><span>Submit Your Item</span></div>
                            <div class="icon">
                                <i class="fa fa-plus"></i>
                            </div>
                        </a>

                    </div>
                </nav>
            </div>
        </div>

        <div id="page-canvas">

            <div id="page-content">
                <section class="container">
                    <div class="row event-head">
                        <script type="text/template" class="templateEvent">
                            <input id="hidden-id" name="userId" class="userId" type="hidden" value="20">

                            <section class="block" id="main-content">
                            <header class="page-title">
                                <div class="title">
                                    <h1><%- item.name %></h1>
                                    <figure><%- item.address %></figure>
                                </div>
                                <div class="info">
                                    <div class="type">
                                        <i><img src="assets/icons/restaurants-bars/restaurants/restaurant.png" alt=""></i>
                                        <span><%- item.type.type %></span>
                                    </div>
                                </div>

                            </header>
                            <div class="row">

                                <aside class="col-md-4 col-sm-4" id="detail-sidebar">

                                    <section>
                                        <header><h3>Контакты организатора</h3></header>
                                        <address>
                                            <div><%- item.creator.name %></div>
                                            <div><strong><%- item.creator.organizationName %></strong></div>
                                            <div><%- item.creator.positionName %></div>
                                            <figure>
                                                <div class="info">
                                                    <i class="fa fa-mobile"></i>
                                                    <span>818-832-5258</span>
                                                </div>
                                                <div class="info">
                                                    <i class="fa fa-globe"></i>
                                                    <a href="#"><%- item.creator.email %></a>
                                                </div>
                                            </figure>
                                        </address>
                                    </section>

<!--                                    <section class="last-events">-->
<!--                                        <header><h3>Последние события организатора</h3></header>-->
<!--                                        <a href="#" class="show-more expand-content" data-expand="#detail-sidebar-event" >Show More</a>-->

<!--                                    </section>-->

                                </aside>

                                <div class="col-md-8 col-sm-8 event-body">

                                </div>

                            </div>
                        </section>

                        </script>
                    </div>
                </section>
            </div>

        </div>


        <script type="text/template" class="templateEventBody">

        <section>
        <article class="block">
            <div class="col-md-9">
                <header><h2>Дата начала</h2></header>
                <p><%-  _.identity(dateWrite(item.timeStart)) %></p>
                <p><%-  _.identity(dateWrite(item.timeEnd))  %></p>

                <header><h2>Описание</h2></header>
                <p><%- item.description  %></p>
                <% _.each( item.itemsList, function( listItem ){ %>
            </div>
            <div class="col-md-3">
                <div class="form-group eventVisit">
                    <form name="visitevent" id="visitevent" role="form" method="post" action="?" >
                        <input id="hidden-user-id" name="userId" class="userId" type="hidden" value="">
                        <input id="hidden-event-id" name="eventId" class="userId" type="hidden" value="<%= item.id %>">
                        <button type="submit" class="btn btn-default">Посетить!</button>
                    </form>
                </div>
            </div>

            <div class="item list">
                <div class="col-md-7">
                    <div class="wrapper">
                        <h3 id="name" class="item-name"><%- listItem.name %></h3></a>
                        <figure id="auditory"><%- listItem.auditory  %></figure>
                        <figure id="timeStart"><%- _.identity(dateWrite(listItem.timeStart)) %></figure>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="wrapper">
                        <div class="form-group">
                            <button type="submit" class="btn btn-default">Добавить в избранные</button>
                        </div>
                    </div>
                </div>
            </div>
            <% }); %>
        </article>
        </section>

        </script>
<!--        <section class="last-events">-->
        <script type="text/template" class="templateList">
            <figure>
                <div class="card-header" role="tab" id="heading<%= item.id %>">
                    <a data-toggle="collapse" data-parent="#accordionEx" href="#collapse<%= item.id %>" aria-expanded="true"
                       aria-controls="collapseOne1">
                        <h5 class="mb-0"><%- item.name %></h5>
                    </a>
                    <p class="address"><%- item.address %></p>
                    <div class="time-and-counters">
                        <div class="time">
                            <div class="time image">
                                <img src="icons/time.png" height="25px"></div>
                            <div class="time text">
                                <%- _.identity(dateWrite(item.timeStart)) %>
                            </div>
                        </div>

                        <div class="right-group">
                            <div class="answers">
                                <div class="answers image">
                                    <img src="icons/answers.png" height="25px"></div>
                                <div class="answers text"><%- _.size(item.items) %></div>
                            </div>

                            <div class="person">
                                <div class="person image">
                                    <img src="icons/person.png" height="25px"></div>
                                <div class="person text"><%- _.size(item.visitors) %></div>
                            </div>
                        </div>
                    </div>
                </div>

            </figure>
        </script>

        <!-- end Page Canvas-->
        <!--Page Footer-->
        <footer id="page-footer">
            <div class="inner">
                <div class="footer-top">
                    <div class="container">
                        <div class="row">

                            <div class="col-md-4 col-sm-4">
                                <section>
                                    <h2>About Us</h2>
                                    <address>
                                        <div>Группа DEV-2</div>
                                        <div>DIMI-MM</div>
                                    </address>

                                </section>
                            </div>
                            <!--/.col-md-4-->
                            <div class="col-md-4 col-sm-4">
                                <!--New Items-->
                                <section>
                                    <h2>Об авторах</h2>
                                    <figure>
                                        <div class="info">
                                            <span>Шаталова Надежда</span>
                                        </div>
                                        <div class="info">
                                            <span>Таиров Александр</span>
                                        </div>
                                    </figure>
                                    <!--/.item-horizontal small-->
                                </section>
                                <!--end New Items-->
                            </div>
                            <div class="col-md-4 col-sm-4">
                                <!--New Items-->
                                <section>
                                    <h2>Вот здесь нас нет</h2>
                                    <div class="social">
                                        <a href="#" class="social-button"><i class="fa fa-twitter"></i></a>
                                        <a href="#" class="social-button"><i class="fa fa-facebook"></i></a>
                                        <a href="#" class="social-button"><i class="fa fa-pinterest"></i></a>
                                    </div>

                                    <!--/.item-horizontal small-->
                                </section>
                                <!--end New Items-->
                            </div>
                        </div>
                        <!--/.row-->
                    </div>
                    <!--/.container-->
                </div>
                <!--/.footer-top-->
                <div class="footer-bottom">
                    <div class="container">
                        <span class="left">(C) EventX, NetCracker, 2020. Students don't have rights</span>
                        <span class="right">
                                <a href="#page-top" class="to-top roll"><i class="fa fa-angle-up"></i></a>
                            </span>
                    </div>
                </div>
                <!--/.footer-bottom-->
            </div>
        </footer>
        <!--end Page Footer-->
    </div>
    <!-- end Inner Wrapper -->
</div>
<!-- end Outer Wrapper-->


<script type="text/javascript" src="js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="js/before.load.js"></script>
<script type="text/javascript" src="js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<!--<script type="text/javascript" src="js/smoothscroll.js"></script>-->
<script type="text/javascript" src="js/bootstrap-select.min.js"></script>
<script type="text/javascript" src="js/jquery.hotkeys.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
<script type="text/javascript" src="js/moment.js"></script>
<script type="text/javascript" src="js/underscore.js"></script>
<script type="text/javascript" src="js/my-scripts/dateWriteFunc.js"></script>
<script type="text/javascript" src="js/my-scripts/listItem.js"></script>

<script>
    (function () {

        const form = document.forms.visitevent;


        // Слушаем, когда на форму подпишутся
        $('.visitevent').on("submit", function (event) {
            event.preventDefault();
            var userFormId = document.getElementById('hidden-user-id');
            userFormId.value = document.getElementById('hidden-id').value;

            let body = {};

            for (let element of form.elements) {
                if (!(element.name === "")){
                    body[element.name] = element.value;
                }
            }
            console.log(body);


            // Делаем запрос на сервер
            fetch(`/api/event-visit?userId=`,{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: JSON.stringify(body)
            })
                // Получаем из ответа JSON
                .then(res => res.json())
                .then(res => alert(JSON.stringify(res)))
                // Обрабатываем ошибки с сервера
                .catch(error => console.log(error))
            window.location.assign("/map");
        })

    })()
</script>

</body>
</html>

